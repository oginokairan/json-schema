{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "MorphProject Schema",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "profile": {
      "type": "string",
      "description": "Morph INI profile name. If omitted, 'default' is used.",
      "default": "default"
    },
    "source_paths": {
      "type": "array",
      "description": "List of directories (or parent directories) for Python/SQL files.",
      "items": {
        "type": "string"
      },
      "default": [
        "src"
      ]
    },

    "default_connection": {
      "description": "Default connection info. Either a string slug, or an object matching MorphConnection (type='morph').",
      "default": "morph_builtin_db", 
      "oneOf": [
        {
          "type": "string"
        },
        {
          "type": "object",
          "description": "MorphConnection-like object. If 'type'=='morph', it can have database_id, connection_slug, etc.",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["morph"]
            },
            "database_id": {
              "type": "string"
            },
            "connection_slug": {
              "type": "string"
            }
          },
          "required": ["type"],
          "additionalProperties": false
        }
      ]
    },

    "output_paths": {
      "type": "array",
      "description": "Where to place output files. Defaults to a path under TMP_MORPH_DIR.",
      "items": {
        "type": "string"
      },
      "default": [
        "${MORPH_TMP}/{name}/{run_id}${ext()}"
      ]
    },

    "scheduled_jobs": {
      "type": "object",
      "description": "Configuration for scheduled jobs. Optional dictionary keyed by function name.",
      "patternProperties": {
        "^[a-zA-Z0-9_]+$": {
          "type": "object",
          "description": "Configuration for a single named job (function).",
          "properties": {
            "schedules": {
              "type": "array",
              "description": "List of individual schedule entries for this function.",
              "items": {
                "type": "object",
                "description": "One schedule entry.",
                "properties": {
                  "cron": {
                    "type": "string",
                    "description": "Must match convertCronToDaysArr logic:\n1) Start with 'cron('\n2) 1st field: one of 0,15,30,45\n3) 2nd field: digits\n4) 4th field: '*'\n5) 5th field: not exactly '?'",
                    "pattern": "^cron\\(\\s*(?:0|15|30|45)\\s+(\\d+)\\s+[^\\s]+\\s+\\*\\s+(?!\\?)\\S+\\s*\\)$"
                  },
                  "is_enabled": {
                    "type": "boolean",
                    "description": "Whether this schedule is active (default: true).",
                    "default": true
                  },
                  "timezone": {
                    "type": "string",
                    "description": "Time zone for execution (default: UTC).",
                    "default": "UTC"
                  },
                  "variables": {
                    "type": "object",
                    "description": "Any additional parameters, stored as JSON.",
                    "additionalProperties": true
                  }
                },
                "required": ["cron"],
                "additionalProperties": false
              }
            }
          },
          "required": ["schedules"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "result_cache_ttl": {
      "type": "integer",
      "description": "TTL for caching results (in seconds). Default: 0 = no caching.",
      "default": 0
    }
  }
}
